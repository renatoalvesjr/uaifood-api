datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}


// ENUMS
enum UserType {
  CLIENT
  ADMIN
}

enum PaymentMethod {
  CASH
  DEBIT
  CREDIT
  PIX
}

// MODELS
model User {
  id            Int    @id @default(autoincrement())
  name          String
  email         String    @unique
  phone         String?
  type          UserType  @default(CLIENT)
  password      String    @unique

  // RELACIONAMENTO 1:1 COM ADDRESS:
  addressId     Int?   @unique
  address       Address?  @relation(fields: [addressId], references: [id])
  
  // Relacionamentos com Order
  orders        Order[]   @relation("UserOrders")
  createdOrders Order[]   @relation("CreatedByUser")

  // Campos de Data
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Address {
  id            Int    @id @default(autoincrement())
  street        String
  number        String?
  district      String?
  city          String
  state         String
  zipCode       String

  // RELACIONAMENTO 1:1 COM USER:
  // O lado 'user' é opcional se o Address puder existir sem um User (não estrito 1:1)
  // Mas como a chave está no User, o campo é apenas para navegação.
  user          User?

  // Campos de Data
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Order {
  id            Int          @id @default(autoincrement())
  
  userClientId  Int
  userClient    User            @relation("UserOrders", fields: [userClientId], references: [id])
  
  userCreatedById Int
  userCreatedBy   User            @relation("CreatedByUser", fields: [userCreatedById], references: [id])
  
  paymentMethod PaymentMethod
  status        String

  items         OrderItem[]

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}

model OrderItem {
  id            Int    @id @default(autoincrement())

  orderId       Int
  order         Order     @relation(fields: [orderId], references: [id])

  itemId        Int
  item          Item      @relation(fields: [itemId], references: [id])

  quantity      Int
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([orderId, itemId])
}

model Item {
  id            Int      @id @default(autoincrement())
  description   String
  unitPrice     Float       @map("double_unitPrice")
  
  categoryId    Int
  category      Category    @relation(fields: [categoryId], references: [id])

  orderItems    OrderItem[]

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Category {
  id            Int    @id @default(autoincrement())
  description   String
  
  items         Item[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}